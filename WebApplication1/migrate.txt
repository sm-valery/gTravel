--20.07.2015 done
CREATE TABLE [dbo].[RiskProgram] (
    [RiskProgramId] UNIQUEIDENTIFIER NOT NULL,
    [ProgramCode]   NCHAR (20)       NULL,
    [RiskSeriaId]   UNIQUEIDENTIFIER NULL,
    [Name]          VARCHAR (50)     NULL,
    [DefaultInsSum] MONEY            NULL,
    [InsSumInList]  BIT              DEFAULT ((0)) NOT NULL,
   + [Num] INT NULL DEFAULT 0, 
    PRIMARY KEY CLUSTERED ([RiskProgramId] ASC)
);

CREATE TABLE [dbo].[RiskSeria] (
    [RiskSeriaId]   UNIQUEIDENTIFIER DEFAULT (newid()) NOT NULL,
    [RiskId]        UNIQUEIDENTIFIER NULL,
    [SeriaId]       UNIQUEIDENTIFIER NULL,
    [isMandatory]   BIT              DEFAULT ((0)) NOT NULL,
    [sort]          INT              DEFAULT ((0)) NULL,
    [InsSumDefauld] NUMERIC (18)     DEFAULT ((0)) NULL,
    [TypeTarif]     INT              DEFAULT ((0)) NULL,
    [hasFranchise]  INT              DEFAULT ((0)) NULL,
+    [InsSumReadOnly] BIT NULL DEFAULT 1, 
    PRIMARY KEY CLUSTERED ([RiskSeriaId] ASC)
);




--16.07.2015 done
--create view vAgents
CREATE TABLE [dbo].[TarifPlan] (
    [TarifPlanId] UNIQUEIDENTIFIER DEFAULT (newid()) NOT NULL,
    [Code]        NCHAR (10)       NULL,
    [Name]        NVARCHAR (50)    NULL,
  +  [SeriaId]     UNIQUEIDENTIFIER NULL,
    PRIMARY KEY CLUSTERED ([TarifPlanId] ASC), 
  +  CONSTRAINT [FK_TarifPlan_ToTable] FOREIGN KEY ([SeriaId]) REFERENCES [seria]([seriaid])
);

CREATE TABLE [dbo].[Territory] (
    [TerritoryId]    UNIQUEIDENTIFIER DEFAULT (newid()) NOT NULL,
    [Name]           VARCHAR (512)    NULL,
    [TerritoryGrpId] UNIQUEIDENTIFIER NULL,
    [ParentId]       UNIQUEIDENTIFIER NULL,
    +[RecomInsSum]    DECIMAL (18)     NULL,
    PRIMARY KEY CLUSTERED ([TerritoryId] ASC)
);


CREATE TABLE [dbo].[AgentSeria] (
    [AgentSeriaId]   UNIQUEIDENTIFIER DEFAULT (newid()) NOT NULL,
    [AgentId]        UNIQUEIDENTIFIER NULL,
    [SeriaId]        UNIQUEIDENTIFIER NULL,
    [TerritoryGrpId] UNIQUEIDENTIFIER NULL,
    [AgentFee]       NUMERIC (18)     NULL,
    +[HidePremium] BIT NULL DEFAULT 0 NOT NULL, 
    PRIMARY KEY CLUSTERED ([AgentSeriaId] ASC),
    CONSTRAINT [FK_AgentSeria_ToAgent] FOREIGN KEY ([AgentId]) REFERENCES [dbo].[Agent] ([AgentId]),
    CONSTRAINT [FK_AgentSeria_ToTerritoryGrp] FOREIGN KEY ([TerritoryGrpId]) REFERENCES [dbo].[TerritoryGrp] ([TerritoryGrpId]),
    CONSTRAINT [FK_AgentSeria_Toseria] FOREIGN KEY ([SeriaId]) REFERENCES [dbo].[seria] ([SeriaId])
);